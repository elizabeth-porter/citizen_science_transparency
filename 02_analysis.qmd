---
title: "Analysis"
code-fold: true
fig-dpi: 600
---

## Background

This is the data exploration and analysis for the manuscript.

## Setup
```{r}
#| include: false
knitr::opts_chunk$set(autodep = TRUE)
```

```{r}
#| message: false
#| code-fold: false
# load necessary packages & preferred settings
  library(tidyverse)

  theme_set(theme_light())
```

## Load Cleaned Data
The following code uses the datasets created in the Initial Exploration that precedes the Analysis section. The datasets are saved to CSV as `data/csp_publication.csv` (each row is a unique citizen science project-publication combination) and `data/publication.csv` (each row is an individual publication).  
```{r}
#| message: false
#| code-fold: false

# Unique citizen science project-publication combinations (N = 377)
df_csp = read_csv("data/csp_publication_clean.csv")

# Individual publications (N = 277)
df_pub = read_csv("data/publication_clean.csv")
```

## Data Exploration
### Citizen Science Projects
```{r}
df_csp %>% 
  group_by(cs_project_grouped) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count)) %>% 
  print(n = "all")
```

### Citizen Science Terminology
```{r}
```

### Number of Citizen Science Projects
```{r}
# all counts
df_pub %>% 
  group_by(cs_count) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count)) %>% 
  print(n = "all")

# one use vs 2+ uses
df_pub %>% 
  mutate(cs_count_group = case_when(
    cs_count == 1 ~ "1",
    cs_count >= 2 ~ "2+"
    )) %>% 
  group_by(cs_count_group) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count)) %>% 
  print(n = "all")
```

**Is there a change in how many citizen science projects are used per publication over time?**\
\
*Logistic regression model (1 = multiple data sets, 0 = single dataset)*

```{r}
df_pub$multiple_datasets = ifelse(df_pub$cs_count >= 2, 1, 0)

model_logit_multi = glm(multiple_datasets ~ publication_year, family = binomial, data = df_pub)

summary(model_logit_multi)
```

**Which projects are used most frequently on their own? Which most frequently alongside others?**
```{r}
df_csp %>% 
  count(cs_count, cs_project_grouped) %>% 
  tidyr::pivot_wider(
    names_from = cs_project_grouped,
    values_from = n,
    values_fill = 0
  ) %>% 
  janitor::adorn_totals(c("row"))
```

### Transparency
**Is citizen science acknowledged at all in the publication?**
```{r}
df_csp %>% 
    mutate(y_n = case_when(
    transp_score == 0 ~ "No",
    transp_score >= 1 ~ "Yes"))%>% 
  group_by(y_n) %>% 
  summarise(count = n())
```
**How many project-publication cases are transparent?**
```{r}
df_csp %>% 
  group_by(transp_group) %>% 
  summarise(count = n())
```

**What is the frequency of transparent vs not transparent attribution cases for each citizen science project?** 
```{r}
transp_group_crosstab = 
df_csp %>% 
  group_by(transp_group, 
           cs_project_grouped) %>% 
  summarise(count = n(), .groups = "drop") %>% 
  spread(cs_project_grouped, count, fill = 0)

transp_group_crosstab

chi_test_result = chisq.test(transp_group_crosstab[ , -1], simulate.p.value = T)
print(chi_test_result)

df_csp %>%
  count(cs_project_grouped, 
        transp_group, 
        name = "count") %>% # Count observations per category
  ggplot(aes(x = reorder(cs_project_grouped, 
                         count), # reorder columns by desc count
             y = count, 
             fill = transp_group)) +  
  geom_bar(stat = "identity") +  
  labs(x = "Citizen Science Project", 
       y = "Number of Cases") +
  scale_fill_manual(values = c("Transparent" = "#ffc000", 
                               "Not transparent" = "#156082")) +
  theme_minimal() +
  theme(legend.position = "bottom",
        legend.title = element_blank())
```
**What is the frequeny of publications over time?**

```{r}
df_csp %>% 
  group_by(publication_year, transp_binary) %>%
  summarise(count = n(), .groups = "drop") %>%
  mutate(status = ifelse(transp_binary == 1, "Transparent", "Not Transparent")) %>%
  ggplot(aes(x = factor(publication_year),
             y = count,
             fill = status)) +
  geom_bar(stat = "identity") +
  labs(x = "Publication Year",
       y = "Number of Cases") +
  scale_fill_manual(values = c("Transparent" = "#ffc000",
                               "Not Transparent" = "#156082")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 60, hjust = 1),
        legend.position = "bottom",
        legend.title = element_blank())
```
## Logistic Regressions 
### 1) Transparency ~ Publication Year
```{r}
model_1 = glm(transp_binary ~ publication_year, 
              data = df_csp, 
              family = binomial)

summary(model_1)

```

### 2) Transparency ~ Publication Year + Citizen Science Project
```{r}
model_2 = glm(transp_binary ~ publication_year + cs_project_grouped, 
              data = df_csp, 
              family = binomial)

summary(model_2)

# Compare model_1 & model_2
anova(model_1, model_2, test = "Chisq")

```

### 3) Transparency ~ Publication Year * Citizen Science Project
```{r}
model_3 = glm(transp_binary ~ publication_year * cs_project_grouped, 
              data = df_csp, 
              family = binomial)

summary(model_3)

# Compare model_2 & model_3
anova(model_2, model_3, test = "Chisq")

```

### 4) Transparency ~ Publication Year + Citizen Science Project + Journal Impact Factor
```{r}
model_4 = glm(transp_binary ~ publication_year + cs_project_grouped + jif, 
              data = df_csp, 
              family = binomial)

summary(model_4)

```

## Main Figure
```{r}
df_csp %>% 
  group_by(publication_year, transp_binary) %>%
  summarise(count = n(), .groups = "drop") %>%
  mutate(status = ifelse(transp_binary == 1, "Transparent", "Not Transparent")) %>%
  ggplot(aes(x = publication_year,
             y = count,
             fill = status)) +
  geom_area(alpha = 0.8) +
  scale_fill_manual(values = c("Transparent" = "#ffc000",
                               "Not Transparent" = "#156082")) +
  labs(x = "Publication Year",
       y = "Number of Cases") +
  theme_minimal() +
  theme(legend.position = "bottom",
        legend.title = element_blank())
```




